---
title: "R markdown 101"
author: "Sébastien Renaut"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: 
  html_document:
    highlight: tango
    number_sections: T
    theme: united
    toc: yes
    toc_depth: 3
    toc_float:
      collapsed: T
csl: ../csl/peerj.csl
bibliography: ../biblio/test_library.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Introduction
##Markdown
Markdown is a **lightweight markup language** with plain text formatting syntax (*Easy-to-read, easy-to-write plain text format*). It is designed so that it can be converted to HTML and many other formats (e.g. PDF, MS Word).

It saves and executes code in order to generate fully reproducible reports in dozens of static and dynamic output formats.

Like other markup languages (e.g. HTML and Latex), it is completely independent from R.

##R Markdown
• R Markdown is an extension of the markdown syntax. R Markdown files are plain text files that typically have the file extension `.Rmd`. They are written using an extension of markdown syntax that enables **R code to be embedded in them in a way which can later be executed**.

• The R package `rmarkdown` package feeds the `.Rmd` file to `knitr`, which executes all of the code chunks and creates a new markdown (`.md`) document which includes the code and it’s output.

• It is subsequently tranformed into `html`/`.tex`/`.docx` by `pandoc`. `.tex` files need to be transformed by `pdflatex` into `.pdf` files.

• `rmardown`, `knitr`, and ``pandoc` are built in `Rstudio`. `pdflatex` is not. We'll come back to that later. 

• When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document.

![](../figures/pandoc1.png){width=500px}

#Get started!
![](../figures/getstarted.png){width=500px}
&nbsp;  
&nbsp;  
1.file>new file>R markdown > HTML   
2.Save it ("myfirstRmarkdown.Rmd")   
3.Knit
4.Let's look at html output. What happened.   
5.Let's look at the `.rmd` file structure  

#Metadata (YAML Ain't Markup Language )
`---`  
`title: "Rmarkdown"`  
`author: "Sebastien Renaut"`  
`date: '2018-03-12'`  
`output: html_document`  
`---`  

• Why YAML (https://en.wikipedia.org/wiki/YAML#History_and_name) ?  
  
• It uses Python-style indentation to specify general options and what kind of document will be created.  

• It is not required (defaults then apply)

• Many options possible depending what type of document you are generating. See below for some examples.

• Note that several options can be specified either for the whole document (in the YAML header), or the code chunks, or both (chunks options superseede YAML header).

##Customizing metadata
`---`  
`title: "Rmarkdown"`  
`author: "Sebastien Renaut"`  
`date: "`r format(Sys.time(), '%B %d, %Y')`"`  
`output:`  
  `html_document:`  
    `highlight: tango`  
    `number_sections: T`  
    `theme: united` 
    `toc: yes`  
    `toc_depth: 3`  
`---`

##Output types 
See the documentation for more information. But these are some [formats](https://rmarkdown.rstudio.com/lesson-9.html) that are of interest.
• `html_document`  
• `ioslides_presentation`  
• `pdf_document`  (This will require that you have a [Latex software](https://www.latex-project.org/get/) installed)
• interactive shiny apps (Well get to that later)

##Table of content options
• `toc: yes` Generate TOC 
• `toc_depth:3` depth of TOC  
• `number_sections:T` Add section numbering to headers (e.g., number_sections: true).
    
##theme, highlight, tabs, other options
• `theme: ` specifies the theme to use for the page  ("cerulean", "journal", "flatly", "readable", "spacelab", "united", and "cosmo")
• `highlight = ` Syntax highlighting style (e.g. "tango", "pygments", "kate", "zenburn")
• `include ` If FALSE, knitr will run the chunk but not include the chunk in the final document  
• See this [Reference guide](https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf)

#Code chunks
Code Chunk output can be customized with knitr options, arguments set in the {} of a chunk header. Below, I use five arguments: 
• In this example, the first code chunk specifies global options. These can be redefined later.   
•  `include = FALSE` prevents code and results from appearing in the finished file. R Markdown still runs the code in the chunk, and the results can be used by other chunks.  
•  `echo = FALSE` prevents code, but not the results from appearing in the finished file. This is a useful way to embed figures.
• `message = FALSE` prevents messages that are generated by code from appearing in the finished file.  
• `warning = FALSE` prevents warnings that are generated by code from appearing in the finished.  
• `fig.cap = "..."` adds a caption to graphical results.  
• `fig.width=..., fig.height=...` to change figure width/heigth.  
• see [cheat sheet](https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf) for more info.   

```{r code chunk example, include = T, message = T, warning=T, echo = T, fig.cap="Figure 1"}
#This is an example using include = T, message = T, warning=T, echo = T, fig.cap="Figure 1".
x = rexp(1000)
min(x)
max(x)
plot(x)
```

• In this example, the first code chunk specifies global options. These can be redefined later. 


##Markdown can read and knitr execute different languages!
**bash**
```{bash}
ls -thor
```

**python**
```{python}
x = "hello python"
print(x.split(' '))
```

**perl**
```{perl}
print "Hello World!";
```

#Formatting basics
Markdown provides an easy way to make standard types of formatted text, like:    
&nbsp;  
• Two spaces for a newline character   
• *italics* (\*text\*) or _italics_ (\_text\_)  
• **bold**  
• `code`  
• [links](rmarkdown.rstudio.com)  
• backslach (\\) to interpret a special characters as character!
• etc.  
• "\&nbsp;  " character for extra line spacing  
• See the [cheatsheet] (https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf)  

##Equations/math symbols (Latex)
• $E = mc^{2}$  
• $\sum_{i=1}^n ASV$  
• $F_{(1,69)}$ =   1.27, *p*-value=0.26  
• inline equation: $A = \pi*r^{2}$   

##References, footnotes, bibliography
• Footnotes are easy when you have a few references [^1]  
• Otherwise, you may specify a bibliography in the YAML metadata header. Example [@Cornwell:2016jk].

`...`  
`csl: csl/peerj.csl`  
`bibliography: biblio/test_library.bib`  
`---`

• `csl` specifies the reference format. 
• The Citation Style Language (CSL) is an open XML-based language to describe the formatting of citations and bibliographies. Reference management programs using CSL include Zotero, Mendeley and Papers.
• Here I just googled and download the .csl file for PlosOne. Most journals should be on this [github repo](https://github.com/citation-style-language/styles). But you could create your own (*YACL - Yet Another Citation Language...*)

• `bib` is my reference library for this project. Here: a .bib file I created in [*Papers3 (reference management software)* (https://www.readcube.com/papers/mac) with some references (eg. @Yoshida:2014bn, @ThibertPlante:2010vw, @Wagner:2012hw).

##Include pictures / figures from a local file or an URL.
• There are several ways to include figures.   
• This is from a URL directly uploaded from the web.   
&nbsp;   
![](https://static.independent.co.uk/s3fs-public/styles/article_large/public/thumbnails/image/2017/09/12/11/naturo-monkey-selfie.jpg){width=250px}  
&nbsp;   
&nbsp;  
&nbsp;  
• This is a graph saved in my directory   
![](../figures/DEG_heatmap.png){width=250px}
&nbsp;  
• In both these cases, graphs are rendering with `pandoc` and not `knitr`. It's simple, but options are tricky.  
• You may need to play with spacing, figure size, and figure position.  
• Options can be specified directly after the URL or link to image with (eg. {width=250px} or eg. {width=50%}).  
• Graphs can be generated directly by R code, specified in a code chunk (options can be specified in the code chunk as we did above) and interpreted by `knitr`.  
• Images can interpreted directly by `knitr` too as below:  

```{r view, out.width = "20%", fig.cap = "Another example", echo = FALSE}
knitr::include_graphics("../figures/orange.jpeg")
```

##Including Tables
• By default, R Markdown displays data frames and matrixes as they would be in the R terminal (in a monospaced font). It is not very pretty.   
• If you prefer that data be displayed with additional formatting you can use the knitr::kable function, as in the .Rmd file below.  

```{r table, echo=T}
#default R printout
print(head(mtcars))

#kable (from knitr)
library(knitr)
kable(head(mtcars),digits =1,caption = "An motorcars table")
```

#Cheatsheets and help
• https://rmarkdown.rstudio.com/lesson-1.html

• Cheatsheet: https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf

• https://rmarkdown.rstudio.com/l

#Now go make your own html file!
• Try loading a picture from the web
• Try running some R code
• Try ploting some results
• Try generating a TOC and several sections
• Add some equations

#References
[^1]: Renaut 2018. footnote number 1. pp1-2
